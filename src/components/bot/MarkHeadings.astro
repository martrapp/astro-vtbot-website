---

---

<script>
	import {
		isTransitionBeforePreparationEvent,
		TRANSITION_BEFORE_PREPARATION,
	} from 'astro:transitions/client';

	export const markHeadings = (doc: Document) => {
		const main = doc.querySelector('main');
		if (main) {
			main
				.querySelectorAll('h1,h2,h3')
				.forEach((e, idx) => ((e as HTMLElement).style.viewTransitionName ||= 'vtbot-hx-' + idx));
		}
	};

	document.addEventListener(TRANSITION_BEFORE_PREPARATION, (e) => {
		if (isTransitionBeforePreparationEvent(e)) {
			markHeadings(document);
			const originalLoader = e.loader;
			e.loader = async () => {
				await originalLoader();
				markHeadings(e.newDocument);
			};
		}
	});
</script>
