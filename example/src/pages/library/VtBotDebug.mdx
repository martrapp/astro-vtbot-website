---
layout: src/layouts/LibraryMdxLayout.astro
title: Reusables
overview: /components/
vtn: vtbotdebug-3
---

import { Picture } from 'astro:assets';
import vtd1_dark from "src/assets/vtd1.dark.png";
import vtd1_light from "src/assets/vtd1.light.png";
import vtd2_dark from "src/assets/vtd2.dark.png";
import vtd2_light from "src/assets/vtd2.light.png";

<h1 style="display: inline-block; view-transition-name: vtbotdebug-1"><span style="display:inline-block; view-transition-name:vtbotdebug-2">üêõ</span>The Debug Component</h1>

The `<VtBotDebug/>` component logs the view transition events and their data. 


## Contents

## Why would I need this component

When View Transitions do not behave the way you expect and you need support in hunting down the bugs, the `<VtBotDebug/>` component can help you. 


### Example Output

During view transitions, the `<VtBotDebug>` component logs four types of information to the console:
* Astro's view transition events and their properties 
* Start and end of the execution of `loader()` and `swap()`
* The transition groups that participate in the transition
* The viewTransition promises `ready`, `updateCallbackDone` and `finished`, how they are resolved or rejected
* The `::view-transition` pseudo-elements that the browser inserts to control the animations of the view transitions
* The scripts that will be executed between `astro:after-swap` and `astro:page-load`
* Upcoming: The animations that run during view transitions 

```console title="console.log" {1,6,7,12,15}
   18:09:18.024 [vtbot-debug] Event handler for astro:before-preparation
‚Øà 18:09:18.025 [vtbot-debug] Properties of the astro:before-preparation event
   18:09:18.027 [vtbot-debug] before execution of loader()
   18:09:18.376 [vtbot-debug] newDocument changed from a1: v1 (18.24 kB) to a2: v2 (11.04 kB)
   18:09:18.376 [vtbot-debug] after execution of loader()
   18:09:18.376 [vtbot-debug] Event handler for astro:after-preparation
   18:09:18.403 [vtbot-debug] Event handler for astro:before-swap
‚Øà 18:09:18.404 [vtbot-debug] Properties of the astro:before-swap event
   18:09:18.407 [vtbot-debug] before execution of swap()
   18:09:18.411 [vtbot-debug] after execution of swap()
‚Øà 18:09:18.412 [vtbot-debug] Transitions from /morph/two/ to /morph/three/
   18:09:18.416 [vtbot-debug] Event handler for astro:after-swap
   18:09:18.423 [vtbot-debug] resolve viewTransition.updateCallbackDone
   18:09:18.425 [vtbot-debug] reject viewTransition.ready with DOMException: Transition was aborted because of invalid state
   18:09:18.447 [vtbot-debug] Event handler for astro:page-load
   18:09:18.710 [vtbot-debug] resolve viewTransition.finished
```

Output for properties and transitions is collapsed by default. Now see what happens when you click on the `‚Øà` symbols.

### Event properties

The detailled view of the properties shows one line for each property of the event. When the value of a property changed since it was last reported, the old and the new value are shown.

```console title="console.log" {1, 12,18}
‚ØÜ 18:09:18.025 [vtbot-debug] Properties of the astro:before-preparation event
   18:09:18.025 type: astro:before-preparation
   18:09:18.025 cancelable: true
   18:09:18.025 defaultPrevented: false
   18:09:18.025 from: http://localhost:4321/morph/two/
   18:09:18.025 to: http://localhost:4321/morph/three/
   18:09:18.026 direction: forward
   18:09:18.026 navigationType: traverse
   18:09:18.026 info: undefined
   18:09:18.027 newDocument: a1: v1 (18.24 kB)
   18:09:18.027 formData: undefined
   18:09:18.027 loader changed from function () { [native code] } to async () => {
		                  await originalLoader();
											if (event.navigationType !== "traverse") {    
										  ...
	 ...
   18:09:18.027 [vtbot-debug] before execution of loader()
   18:09:18.376 [vtbot-debug] newDocument changed from a1: v1 (18.24 kB) to a2: v2 (11.04 kB)
   18:09:18.376 [vtbot-debug] after execution of loader()
```	

### Transition groups

The `<VtBotDebug>` component logs the transition groups that participate in the transition. Beside the name of the transition group, the component shows the CSS selector that matches the elements on the current page and the target page of the navigation. `(nowhere)` is used as placeholder if the transition name does not appear on both pages. 

```console title="console.log" {1, 5}
‚ØÜ 18:09:18.412 [vtbot-debug] Transitions from /morph/two/ to /morph/three/
   18:09:18.413 [ transition] 1 "a21" from body > p > a --to-> (nowhere)
   18:09:18.413 [ transition] 2 "a22" from body > p:nth-of-type(2) > a --to-> (nowhere)
   18:09:18.413 [ transition] 3 "a23" from body > p:nth-of-type(2) > a:nth-of-type(2) --to-> (nowhere)
   18:09:18.414 [ transition] 4 "a24" from body > p:nth-of-type(4) > a --to-> html > body > h1
   18:09:18.414 [ transition] 5 "root" from html --to-> html
   18:09:18.414 [ transition] 6 "a31" from (nowhere) --to-> html > body > p:nth-of-type(3) > a
```

#### Pseudo elements (since v1.1.3)

`<VtBotDebug>` now logs the `::view-transition` CSS pseudo-elements that the browser inserts to control the animations of the view transitions. Here an example with collapsed output:

<Picture class="dark" src={vtd1_dark} formats={['avif', 'webp']} alt="Example ::view-transition output" />
<Picture class="light" src={vtd1_light} formats={['avif', 'webp']} alt="Example ::view-transition output" />

... and with all items exapanded:
<Picture class="dark" src={vtd2_dark} formats={['avif', 'webp']} alt="Example ::view-transition output" />
<Picture class="light" src={vtd2_light} formats={['avif', 'webp']} alt="Example ::view-transition output" />

### Scripts
Inline scripts of the new page are executed between `astro:after-swap` and `astro:page-load` if they had not been on the old page. Module scripts are executed the first time they are found after a full page reload. Later occurences on other pages will not result in re-execution as module scrips can only be refreshed in the browser by full page loads.

\[Example output tbd\]

```console title="console.log" {1, 2, 3}
	 18:09:18.447 [vtbot-debug] Event handler for astro:page-load
	 18:09:18.447 [vtbot-debug] Scripts to be executed between astro:after-swap and astro:page-load
	 18:09:18.447 [vtbot-debug] 1: <script>console.log("inline script 1")</script>
	 18:09:18.447 [vtbot-debug] 2: <script>console.log("inline script 2")</script>
	 18:09:18.447 [vtbot-debug] 3: <script>console.log("inline script 3")</script>
``` 

### View Transition promises

After the view transition got startet, the API provides three promises that can be used to wait for different stages of the transition. The `<VtBotDebug>` component logs when these promises are resolved or rejected. If rejected, the reason is also shown.


```console title="console.log" {1,2,4}
   18:09:18.423 [vtbot-debug] resolve viewTransition.updateCallbackDone
   18:09:18.425 [vtbot-debug] reject viewTransition.ready with DOMException: Transition was aborted because of invalid state
	 18:09:18.447 [vtbot-debug] Event handler for astro:page-load
   18:09:18.710 [vtbot-debug] resolve viewTransition.finished
```


## Usage

[Install astro-vtbot](../Installation/) in your project as an Astro integration with `npx astro add astro-vtbot` or as a node module with `npm install astro-vtbot`.

The `<VtBotDebug>` component should be inserted as early as possible in the `<head>` of the page you want to investigate. As it only works for pages with view transitions, it is a good idea to place it just before the `<ViewTransitions />` component.

```astro title="MyPage.astro" {3,7}
---
import { ViewTransitions } from 'astro:transitions';
import VtBotDebug from 'astro-vtbot/components/VtBotDebug.astro';
---
<html>
  <head>
    <VtBotDebug />
    <ViewTransitions />
    ...
  </head>
  ...
</html>
```
### Attributes

The `<VtBotDebug>` component offers three boolean properties to control its behaviour:

|   Property | Effect |
|------------|---------|
| production | Be active in production mode. Helpful when chasing bugs the do not show up in development mode but only in a full build.|


```astro title="PageToDebug.astro" {3}
<html>
  <head>
    <VtBotDebug production />
		<ViewTransitions />
  </head>
  ...
</html>
```


<style>{`

img {
	width: 60ch;
}

`}</style>
